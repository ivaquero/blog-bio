---
title: 搭建 C/C++ 轻量级编程环境（VSCode）
zhihu-url: https://zhuanlan.zhihu.com/p/493323612
zhihu-title-image: images/vscode/vscode-cpp.png
zhihu-tags: Visual Studio Code, C / C++
---

# 搭建 C/C++ 轻量级编程环境（VSCode）

## 1.  工具链

工具链是整个编程环境的核心，在 MacOS/Linux 上，系统内置了库文件，但是在 Windows 上，库文件需要自行下载，所以这里只介绍 Windows 上的库文件下载。我们这里选择的微软官方推荐的 MSYS2。

### 1.1. 安装

- 手动安装

下载[安装包](https://mirrors.tuna.tsinghua.edu.cn/msys2/distrib/msys2-x86_64-latest.exe)，默认一路向下，直至完成。

- 包管理器安装

```powershell
scoop install scoopforge/extras-cn/msys2-cn
```

### 1.2. 配置

进入 MSYS2 终端，执行如下命令，使用清华源

```sh
sed -i "s#https\?://mirror.msys2.org/#https://mirrors.tuna.tsinghua.edu.cn/msys2/#g" /etc/pacman.d/mirrorlist*
```

然后安装 UCRT (Universal C Runtime) 工具链

```sh
pacman -S --needed base-devel mingw-w64-ucrt-x86_64-toolchain
```

- 接受默认配置，一路向下直至完成安装。
- 将 `ucrt64\bin` 目录添加到环境变量 `PATH` 中
- 重启计算机

重启终端，在 PowerShell 中，检验是否安装成功

```powershell
gcc --version
g++ --version
gdb --version
```

## 2. VSCode 扩展

### 2.1. C/C++

官方 C/C++ 扩展是必装的，虽然有些笨重，还有各种瑕疵，但是其集成了不少非常实用的工具链的接口。

![cpp](images/vscode/vscode-cpp.png)

安装完毕后，"ctrl +," 进入配置，点击右上角的图标，打开 `settings.json`

基本配置如下

```json
{
  "C_Cpp.autocompleteAddParentheses": true,
  "C_Cpp.default.cppStandard": "c++20",
  "C_Cpp.default.cStandard": "c17",
  "C_Cpp.default.mergeConfigurations": true,
}
```

`.vscode/c_cpp_properties.json`：用于使用 VSCode 自带的代码提示工具，如 IntelliSense

```json
{
    "configurations": [
        {
            "name": "GCC",
            "includePath": [
                "${workspaceFolder}/**"
            ],
            "defines": [
                "_DEBUG",
                "UNICODE",
                "_UNICODE"
            ],
            "windowsSdkVersion": "10.0.22000.0",
            "compilerPath": "C:\\msys64\\ucrt64\\bin\\g++.exe",
            "cStandard": "c99",
            "cppStandard": "c++20",
            "intelliSenseMode": "windows-gcc-x64"
        }
    ],
    "version": 4
}
```

### 2.2. Code Runner

Code Runner 是一个通用的单文件一键编译/运行扩展，其相关配置如下

对 Linux 以及 Windows 用户

```json
{
  "code-runner.runInTerminal": true,
  "code-runner.executorMap": {
    "c": "cd $dir && gcc $fileName -o $fileNameWithoutExt && $dir$fileNameWithoutExt",
    "cpp": "cd $dir && g++ -std=c++20 $fileName -o $fileNameWithoutExt && $dir$fileNameWithoutExt",
    "rust": "rustc $dir$fileName && $dir$fileNameWithoutExt"
  },
  "code-runner.fileDirectoryAsCwd": true
}
```

> macOS 用户将 `code-runner.executorMap` 中的 `gcc` 换成 `clang`，`g++` 换成 `clang++` 即可。

## 3. 编译

### 3.1. tasks.json

`.vscode/tasks.json`：编译指令设置，用于编译

```json
{
    "tasks": [
        {
            "type": "cppbuild",
            "label": "C/C++: g++.exe build active file",
            "command": "C:\\msys64\\ucrt64\\bin\\g++.exe",
            "args": [
                "-fdiagnostics-color=always",
                "-g",
                "${file}",
                "-o",
                "${fileDirname}\\${fileBasenameNoExtension}.exe"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "detail": "Task generated by Debugger."
        }
    ],
    "version": "2.0.0"
}
```

### 3.2. CMake 扩展

对 C++ 工程来说，CMake 常常是其必不可少的一部分。CMake Tools 为微软官方出品，绑定了 CMake 语言基础扩展。这是一个涵盖 了 CMake 的构建和 Debug 等大部分基础功能的扩展，可认为是 VSCode 中相关扩展的首选。

- 启动 CMake 扩展的 Quick Start，扫描工具链
- 选择刚刚安装好的 `GCC 14.1.0 x86_64-w64-mingw32 (ucrt64)`
- 最后会自动生成一个 `CMakePresets.json` 文件，可参考如下配置

```json
{
    "version": 8,
    "configurePresets": [
        {
            "name": "debug",
            "displayName": "GCC 14.1.0 x86_64-w64-mingw32 (ucrt64)",
            "description": "Using compilers: C = C:\\msys64\\ucrt64\\bin\\gcc.exe, CXX = C:\\msys64\\ucrt64\\bin\\g++.exe",
            "generator": "MinGW Makefiles",
            "binaryDir": "${sourceDir}/out/build/${presetName}",
            "cacheVariables": {
                "CMAKE_INSTALL_PREFIX": "${sourceDir}/out/install/${presetName}",
                "CMAKE_C_COMPILER": "C:/Scoop/apps/msys2/current/ucrt64/bin/gcc.exe",
                "CMAKE_CXX_COMPILER": "C:/Scoop/apps/msys2/current/ucrt64/bin/g++.exe",
                "CMAKE_BUILD_TYPE": "Debug"
            }
        }
    ]
}
```

## 4. 调试

### 4.1. launch.json

`launch.json`：调试器设置，用于使用 VSCode 自带的 debug 工具

- `label` 参数值和 `tasks.json` 的 `preLaunchTask` 参数值需要保持一致

```json
{
    "configurations": [
        {
            "name": "C/C++: g++.exe build and debug active file",
            "type": "cppdbg",
            "request": "launch",
            "program": "${fileDirname}\\${fileBasenameNoExtension}.exe",
            "args": [],
            "stopAtEntry": false,
            "cwd": "${fileDirname}",
            "environment": [],
            "externalConsole": false,
            "MIMode": "gdb",
            "miDebuggerPath": "C:\\msys64\\ucrt64\\bin\\gdb.exe",
            "setupCommands": [
                {
                    "description": "Enable pretty-printing for gdb",
                    "text": "-enable-pretty-printing",
                    "ignoreFailures": true
                },
                {
                    "description": "Set Disassembly Flavor to Intel",
                    "text": "-gdb-set disassembly-flavor intel",
                    "ignoreFailures": true
                }
            ],
            "preLaunchTask": "C/C++: g++.exe build active file"
        }
    ],
    "version": "2.0.0"
}
```
